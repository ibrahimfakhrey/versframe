{% extends "base_dashboard.html" %}

{% block topbar_title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯{% endblock %}

{% block sidebar_nav %}
<a class="sidebar-nav-item" href="{{ url_for('admin.dashboard') }}">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.users') }}">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.groups') }}">ğŸ“š Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.sessions') }}">ğŸ“ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</a>
<a class="sidebar-nav-item active" href="{{ url_for('admin.resources') }}">ğŸ“ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.activities') }}">ğŸ® Ø§Ù„Ø£Ù†Ø´Ø·Ø©</a>
<a class="sidebar-nav-item" href="{{ url_for('curriculum.home') }}">ğŸ“– Ø§Ù„Ù…Ù†Ù‡Ø¬</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.reports') }}">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
<a class="sidebar-nav-item" href="{{ url_for('admin.settings') }}">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
{% endblock %}

{% block content %}
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-lg);flex-wrap:wrap;gap:var(--space-md);">
    <div style="display:flex;gap:var(--space-sm);flex-wrap:wrap;align-items:center;">
        <a href="{{ url_for('admin.resources') }}" class="btn {{ 'btn-primary' if not type_filter else 'btn-outline' }} btn-sm">Ø§Ù„ÙƒÙ„</a>
        <a href="{{ url_for('admin.resources', type='slides', track_id=track_filter) }}" class="btn {{ 'btn-primary' if type_filter=='slides' else 'btn-outline' }} btn-sm">Ø´Ø±Ø§Ø¦Ø­</a>
        <a href="{{ url_for('admin.resources', type='code_exercise', track_id=track_filter) }}" class="btn {{ 'btn-primary' if type_filter=='code_exercise' else 'btn-outline' }} btn-sm">ØªÙ…Ø§Ø±ÙŠÙ† Ø¨Ø±Ù…Ø¬ÙŠØ©</a>
        <a href="{{ url_for('admin.resources', type='video', track_id=track_filter) }}" class="btn {{ 'btn-primary' if type_filter=='video' else 'btn-outline' }} btn-sm">ÙÙŠØ¯ÙŠÙˆ</a>
        <a href="{{ url_for('admin.resources', type='game', track_id=track_filter) }}" class="btn {{ 'btn-primary' if type_filter=='game' else 'btn-outline' }} btn-sm">Ù„Ø¹Ø¨Ø©/Ù†Ø´Ø§Ø·</a>
        <select onchange="filterByTrack(this.value)" style="padding:4px 10px;border-radius:var(--radius-sm);border:1px solid var(--border);font-family:var(--font-ar);font-size:var(--text-sm);">
            <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</option>
            {% for t in tracks %}
            <option value="{{ t.id }}" {{ 'selected' if track_filter == t.id else '' }}>{{ t.name_ar }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{{ url_for('admin.resource_create') }}" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</a>
</div>

<div class="card">
    <table class="table">
        <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø³Ø§Ø±</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody>
            {% for r in items %}
            <tr>
                <td>
                    <div style="font-weight:600;">{{ r.name_ar or r.name }}</div>
                    <div class="text-xs text-muted">{{ r.name }}</div>
                </td>
                <td>
                    {% if r.type.value == 'video' %}
                    <span class="badge" style="background:rgba(214,48,49,0.1);color:#d63031;">ÙÙŠØ¯ÙŠÙˆ</span>
                    {% elif r.type.value == 'game' %}
                    <span class="badge" style="background:rgba(0,184,148,0.1);color:#00b894;">Ù„Ø¹Ø¨Ø©</span>
                    {% elif r.type.value == 'slides' %}
                    <span class="badge" style="background:rgba(9,132,227,0.1);color:#0984e3;">Ø´Ø±Ø§Ø¦Ø­</span>
                    {% else %}
                    <span class="badge">{{ r.type.value }}</span>
                    {% endif %}
                </td>
                <td class="text-sm">{{ r.track.name_ar if r.track else 'â€”' }}</td>
                <td>
                    <a href="{{ url_for('admin.resource_edit', resource_id=r.id) }}" class="btn btn-ghost btn-sm">ØªØ¹Ø¯ÙŠÙ„</a>
                    <form method="POST" action="{{ url_for('admin.resource_delete', resource_id=r.id) }}" style="display:inline;" onsubmit="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯ØŸ')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-ghost btn-sm" style="color:var(--status-error);">Ø­Ø°Ù</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="text-center text-muted" style="padding:var(--space-xl);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø±Ø¯</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if pages > 1 %}
<div class="pagination">
    {% for p in range(1, pages + 1) %}
    <a href="{{ url_for('admin.resources', page=p, type=type_filter, track_id=track_filter) }}" class="pagination-item {{ 'active' if p == page else '' }}">{{ p }}</a>
    {% endfor %}
</div>
{% endif %}

<script>
function filterByTrack(trackId) {
    var params = new URLSearchParams(window.location.search);
    if (trackId) {
        params.set('track_id', trackId);
    } else {
        params.delete('track_id');
    }
    params.delete('page');
    window.location.search = params.toString();
}
</script>
{% endblock %}
