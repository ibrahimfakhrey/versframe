{% extends "base_dashboard.html" %}

{% block page_title %}Ø¬Ù„Ø³Ø§ØªÙŠ - Ø´Ù„Ø¨ÙŠ ÙÙŠØ±Ø³{% endblock %}

{% block dashboard_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teacher.css') }}">
{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('teacher.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('teacher.groups') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ‘¥</span>
    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
</a>
<a href="{{ url_for('teacher.sessions') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ“…</span>
    <span>Ø§Ù„Ø¬Ù„Ø³Ø§Øª</span>
</a>
<a href="{{ url_for('teacher.homework') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ“</span>
    <span>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</span>
</a>
{% endblock %}

{% block topbar_title %}Ø§Ù„Ø¬Ù„Ø³Ø§Øª{% endblock %}

{% block topbar_actions %}
<button class="btn btn-sm btn-primary" onclick="document.getElementById('newSessionModal').classList.add('active')">
    + Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
</button>
{% endblock %}

{% block content %}
<!-- Stats Overview -->
<div class="stats-grid">
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--sv-purple-glow); color: var(--sv-purple);">ğŸ“…</div>
        <div>
            <div class="stat-value">{{ total|default(0) }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--info-light); color: var(--info);">ğŸ•</div>
        <div>
            <div class="stat-value">{{ items|selectattr('status.value', 'equalto', 'scheduled')|list|length }}</div>
            <div class="stat-label">Ø¬Ù„Ø³Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø©</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--sv-orange-glow); color: var(--sv-orange);">ğŸ”´</div>
        <div>
            <div class="stat-value">{{ items|selectattr('status.value', 'equalto', 'live')|list|length }}</div>
            <div class="stat-label">Ø¬Ù„Ø³Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--success-light); color: var(--success);">âœ…</div>
        <div>
            <div class="stat-value">{{ items|selectattr('status.value', 'equalto', 'completed')|list|length }}</div>
            <div class="stat-label">Ø¬Ù„Ø³Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
    </div>
</div>

<!-- Sessions Table -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h2>
    </div>

    {% if items %}
    <div class="table-wrapper">
        <table class="table">
            <thead>
                <tr>
                    <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ù„Ø³Ø©</th>
                    <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ù…Ø¯Ø©</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for session in items %}
                <tr>
                    <td>
                        <a href="{{ url_for('teacher.session_detail', session_id=session.id) }}" style="font-weight: 700; color: var(--sv-purple); text-decoration: none;">
                            {{ session.title }}
                        </a>
                    </td>
                    <td>
                        {% if session.group %}
                        <a href="{{ url_for('teacher.group_detail', group_id=session.group.id) }}" class="text-sm" style="color: var(--text-secondary); text-decoration: none;">
                            {{ session.group.name }}
                        </a>
                        {% else %}
                        <span class="text-muted">--</span>
                        {% endif %}
                    </td>
                    <td class="text-sm">{{ session.scheduled_at|default('', true) }}</td>
                    <td class="text-sm">{{ session.duration_minutes|default(60) }} Ø¯Ù‚ÙŠÙ‚Ø©</td>
                    <td>
                        {% if session.status.value == 'scheduled' %}
                            <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„Ø©</span>
                        {% elif session.status.value == 'live' %}
                            <span class="badge badge-orange">Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                        {% elif session.status.value == 'completed' %}
                            <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„Ø©</span>
                        {% elif session.status.value == 'cancelled' %}
                            <span class="badge badge-danger">Ù…Ù„ØºÙŠØ©</span>
                        {% endif %}
                    </td>
                    <td style="display: flex; gap: var(--space-xs); align-items: center;">
                        <a href="{{ url_for('teacher.session_detail', session_id=session.id) }}" class="btn btn-sm btn-primary">
                            ØªÙØ§ØµÙŠÙ„
                        </a>
                        {% if session.status.value == 'scheduled' %}
                        <form action="{{ url_for('teacher.session_start', session_id=session.id) }}" method="POST" style="margin:0;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-orange">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
                        </form>
                        {% elif session.status.value == 'live' %}
                        <a href="{{ url_for('room.room', session_id=session.id) }}" class="btn btn-sm btn-orange">
                            Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©
                        </a>
                        <form action="{{ url_for('teacher.session_end', session_id=session.id) }}" method="POST" style="margin:0;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')">Ø¥Ù†Ù‡Ø§Ø¡</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="{{ url_for('teacher.sessions', page=page-1) }}">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
        {% endif %}
        {% for p in range(1, pages + 1) %}
            {% if p == page %}
            <span class="active">{{ p }}</span>
            {% else %}
            <a href="{{ url_for('teacher.sessions', page=p) }}">{{ p }}</a>
            {% endif %}
        {% endfor %}
        {% if page < pages %}
        <a href="{{ url_for('teacher.sessions', page=page+1) }}">Ø§Ù„ØªØ§Ù„ÙŠ</a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ“…</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        <p class="text-muted text-sm">Ø£Ù†Ø´Ø¦ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø·Ù„Ø§Ø¨Ùƒ</p>
        <button class="btn btn-primary" onclick="document.getElementById('newSessionModal').classList.add('active')" style="margin-top: var(--space-md);">
            + Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
    </div>
    {% endif %}
</div>

<!-- New Session Modal -->
<div class="modal-overlay" id="newSessionModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <button class="modal-close" onclick="document.getElementById('newSessionModal').classList.remove('active')">Ã—</button>
        </div>

        <form action="{{ url_for('teacher.session_create') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="form-group">
                <label class="form-label" for="session_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                <input type="text" class="form-input" id="session_title" name="title" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="session_group">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                <select class="form-select" id="session_group" name="group_id" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©...</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}">{{ group.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="session_scheduled_at">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                <input type="datetime-local" class="form-input" id="session_scheduled_at" name="scheduled_at" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="session_duration">Ø§Ù„Ù…Ø¯Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                <input type="number" class="form-input" id="session_duration" name="duration_minutes" value="60" min="15" max="180" required>
                <div class="form-hint">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© 60 Ø¯Ù‚ÙŠÙ‚Ø©</div>
            </div>

            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
                <button type="button" class="btn btn-ghost" onclick="document.getElementById('newSessionModal').classList.remove('active')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block dashboard_js %}
<script src="{{ url_for('static', filename='js/teacher.js') }}"></script>
{% endblock %}
