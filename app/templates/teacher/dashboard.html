{% extends "base_dashboard.html" %}

{% block topbar_title %}Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…{% endblock %}

{% block sidebar_nav %}
<a class="sidebar-nav-item active" href="{{ url_for('teacher.dashboard') }}">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
<a class="sidebar-nav-item" href="{{ url_for('teacher.groups') }}">ğŸ“š Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÙŠ</a>
<a class="sidebar-nav-item" href="{{ url_for('teacher.sessions') }}">ğŸ“ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</a>
<a class="sidebar-nav-item" href="{{ url_for('teacher.timetable') }}">ğŸ—“ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</a>
<a class="sidebar-nav-item" href="{{ url_for('teacher.homework') }}">ğŸ“ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</a>
{% endblock %}

{% block content %}
<!-- Today's Sessions -->
<h2 style="margin-bottom:var(--space-md);">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
{% if upcoming %}
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:var(--space-md);margin-bottom:var(--space-xl);">
    {% for s in upcoming %}
    <div class="card" style="border-right:4px solid var(--sv-purple);">
        <h3 style="margin-bottom:var(--space-xs);">{{ s.title }}</h3>
        <div class="text-sm text-muted" style="margin-bottom:var(--space-sm);">
            {{ s.group.name if s.group else 'â€”' }} | {{ s.scheduled_at.strftime('%H:%M') if s.scheduled_at else 'â€”' }}
        </div>
        <div style="display:flex;gap:var(--space-sm);">
            <form action="{{ url_for('teacher.session_start', session_id=s.id) }}" method="POST" style="margin:0;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-primary btn-sm">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
            </form>
            <a href="{{ url_for('teacher.session_detail', session_id=s.id) }}" class="btn btn-outline btn-sm">ØªÙØ§ØµÙŠÙ„</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card" style="text-align:center;padding:var(--space-xl);margin-bottom:var(--space-xl);">
    <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</p>
</div>
{% endif %}

<div class="two-col-grid">
    <!-- My Groups -->
    <div class="card">
        <div class="card-header">
            <h3>Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÙŠ</h3>
            <a href="{{ url_for('teacher.groups') }}" class="btn btn-ghost btn-sm">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
        </div>
        <div class="card-body">
            {% for g in groups %}
            <a href="{{ url_for('teacher.group_detail', group_id=g.id) }}" class="activity-item" style="text-decoration:none;color:inherit;">
                <div style="width:40px;height:40px;background:var(--sv-purple-glow);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--sv-purple);">{{ g.students.count() }}</div>
                <div style="flex:1;">
                    <div style="font-weight:600;">{{ g.name }}</div>
                    <div class="text-sm text-muted">{{ g.track.name_ar if g.track else '' }} | {{ g.students.count() }} Ø·Ø§Ù„Ø¨</div>
                </div>
            </a>
            {% else %}
            <div class="empty-state-inline">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Sessions -->
    <div class="card">
        <div class="card-header">
            <h3>Ø¢Ø®Ø± Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h3>
            <a href="{{ url_for('teacher.sessions') }}" class="btn btn-ghost btn-sm">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
        </div>
        <div class="card-body">
            {% for s in recent %}
            <div class="activity-item">
                <div style="flex:1;">
                    <div style="font-weight:600;">{{ s.title }}</div>
                    <div class="text-sm text-muted">{{ s.group.name if s.group else 'â€”' }} | {{ s.scheduled_at.strftime('%Y-%m-%d') if s.scheduled_at else '' }}</div>
                </div>
                <span class="badge">Ù…ÙƒØªÙ…Ù„Ø©</span>
            </div>
            {% else %}
            <div class="empty-state-inline">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block dashboard_js %}
<script src="{{ url_for('static', filename='js/teacher.js') }}"></script>
{% endblock %}
