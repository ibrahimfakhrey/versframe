{% extends "base_dashboard.html" %}

{% block page_title %}{{ group.name }} - Ø´Ù„Ø¨ÙŠ ÙÙŠØ±Ø³{% endblock %}

{% block dashboard_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teacher.css') }}">
{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('teacher.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('teacher.groups') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ‘¥</span>
    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
</a>
<a href="{{ url_for('teacher.sessions') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ“…</span>
    <span>Ø§Ù„Ø¬Ù„Ø³Ø§Øª</span>
</a>
<a href="{{ url_for('teacher.timetable') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ—“</span>
    <span>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span>
</a>
<a href="{{ url_for('teacher.homework') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ“</span>
    <span>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</span>
</a>
{% endblock %}

{% block topbar_title %}{{ group.name }}{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('teacher.groups') }}" class="btn btn-sm btn-ghost">
    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
</a>
{% endblock %}

{% block content %}
<!-- Group Info Header -->
<div class="stats-grid">
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--sv-purple-glow); color: var(--sv-purple);">ğŸ‘¥</div>
        <div>
            <div class="stat-value">{{ group.student_count }}</div>
            <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--sv-orange-glow); color: var(--sv-orange);">ğŸ“…</div>
        <div>
            <div class="stat-value">{{ sessions|length }}</div>
            <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--info-light); color: var(--info);">ğŸ“š</div>
        <div>
            <div class="stat-value">{{ group.track_id|default('--', true) }}</div>
            <div class="stat-label">Ø§Ù„Ù…Ø³Ø§Ø±</div>
        </div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon" style="background: var(--success-light); color: var(--success);">ğŸ¯</div>
        <div>
            <div class="stat-value">{{ group.level_id|default('--', true) }}</div>
            <div class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
        </div>
    </div>
</div>

<!-- Group Details -->
<div class="dashboard-grid">
    <div class="dashboard-grid-main">
        <!-- Students List -->
        <div class="card" style="margin-bottom: var(--space-xl);">
            <div class="card-header">
                <h2 class="card-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <span class="badge badge-purple">{{ group.student_count }} Ø·Ø§Ù„Ø¨</span>
            </div>

            {% set students_list = group.students.all() %}
            {% if students_list %}
            <div class="student-grid">
                {% for gs in students_list %}
                <div class="card student-card">
                    <div class="avatar">
                        {% if gs.student.avatar_url %}
                        <img src="{{ gs.student.avatar_url }}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                        {% else %}
                        {{ gs.student.name_ar[0] if gs.student.name_ar else '?' }}
                        {% endif %}
                    </div>
                    <div>
                        <div class="student-card-name">{{ gs.student.name_ar }}</div>
                        <div class="student-card-meta">
                            Ø§Ù†Ø¶Ù… {{ gs.joined_at|default('', true) }}
                        </div>
                    </div>
                    <a href="{{ url_for('teacher.student_profile', student_id=gs.student.id) }}" class="btn btn-sm btn-outline" style="margin-right: auto;">
                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“</div>
                <div class="empty-state-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¹Ø¯</div>
            </div>
            {% endif %}
        </div>

        <!-- Group Sessions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</h2>
            </div>

            {% if sessions %}
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ù„Ø³Ø©</th>
                            <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                            <th>Ø§Ù„Ù…Ø¯Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in sessions %}
                        <tr>
                            <td style="font-weight: 700;">{{ s.title }}</td>
                            <td class="text-sm">{{ s.scheduled_at|default('', true) }}</td>
                            <td class="text-sm">{{ s.duration_minutes|default(60) }} Ø¯Ù‚ÙŠÙ‚Ø©</td>
                            <td>
                                {% if s.status.value == 'scheduled' %}
                                    <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„Ø©</span>
                                {% elif s.status.value == 'live' %}
                                    <span class="badge badge-orange">Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                                {% elif s.status.value == 'completed' %}
                                    <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„Ø©</span>
                                {% elif s.status.value == 'cancelled' %}
                                    <span class="badge badge-danger">Ù…Ù„ØºÙŠØ©</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('teacher.session_detail', session_id=s.id) }}" class="btn btn-sm btn-primary">
                                    ØªÙØ§ØµÙŠÙ„
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“…</div>
                <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¹Ø¯</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Sidebar Info -->
    <div class="dashboard-grid-aside">
        <div class="card">
            <h3 class="card-title" style="margin-bottom: var(--space-md);">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</h3>
            <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                <div>
                    <div class="text-muted text-sm">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</div>
                    <div style="font-weight: 700;">{{ group.name }}</div>
                </div>
                <div>
                    <div class="text-muted text-sm">Ø§Ù„Ù…Ø³Ø§Ø±</div>
                    <div style="font-weight: 700;">{{ group.track_id|default('ØºÙŠØ± Ù…Ø­Ø¯Ø¯', true) }}</div>
                </div>
                <div>
                    <div class="text-muted text-sm">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                    <div style="font-weight: 700;">{{ group.level_id|default('ØºÙŠØ± Ù…Ø­Ø¯Ø¯', true) }}</div>
                </div>
                <div>
                    <div class="text-muted text-sm">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø§Ø¨</div>
                    <div style="font-weight: 700;">{{ group.max_students|default(12) }}</div>
                </div>
                <div>
                    <div class="text-muted text-sm">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                    <div>
                        {% if group.is_active %}
                            <span class="badge badge-success">Ù†Ø´Ø·Ø©</span>
                        {% else %}
                            <span class="badge badge-danger">ØºÙŠØ± Ù†Ø´Ø·Ø©</span>
                        {% endif %}
                    </div>
                </div>
                {% if group.schedule_notes %}
                <div>
                    <div class="text-muted text-sm">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„</div>
                    <div style="font-size: var(--text-sm);">{{ group.schedule_notes }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
