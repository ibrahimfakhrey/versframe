{% extends "base_dashboard.html" %}

{% block title %}ØªÙ‚Ø§Ø±ÙŠØ± {{ child.name_ar }}{% endblock %}
{% block topbar_title %}ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('parent.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('parent.children') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦</span>
    <span>Ø£Ø¨Ù†Ø§Ø¦ÙŠ</span>
</a>
<a href="{{ url_for('parent.messages') }}" class="sidebar-link">
    <span class="sidebar-icon">âœ‰ï¸</span>
    <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
</a>
{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('parent.child_detail', child_id=child.id) }}" class="btn btn-sm btn-ghost">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
{% endblock %}

{% block content %}
<!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
<div class="page-header">
    <h2 class="page-title">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± {{ child.name_ar }}</h2>
    <p class="page-subtitle">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
</div>

<!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
<div class="tabs" id="reportTabs">
    <button class="tab active" onclick="switchReportTab('assessments', this)">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
    <button class="tab" onclick="switchReportTab('sessions', this)">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ØµØµ</button>
</div>

<!-- ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
<div id="tab-assessments">
    {% if assessment_reports %}
    <div style="display: flex; flex-direction: column; gap: var(--space-md);">
        {% for report in assessment_reports %}
        <div class="card">
            <div class="card-header">
                <div>
                    <h4 class="card-title">{{ report.title or 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ…' }}</h4>
                    <div style="font-size: var(--text-xs); color: var(--text-secondary); margin-top: var(--space-xs);">
                        {{ report.created_at.strftime('%Y-%m-%d') if report.created_at else '' }}
                        {% if report.assessor %}
                        &middot; Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…: {{ report.assessor.name_ar }}
                        {% endif %}
                    </div>
                </div>
                <div>
                    {% if report.score is not none %}
                    <div style="text-align: center;">
                        <div style="font-size: var(--text-2xl); font-weight: var(--fw-extrabold); color: var(--sv-purple);">{{ report.score }}%</div>
                        <div style="font-size: var(--text-xs); color: var(--text-secondary);">Ø§Ù„Ø¯Ø±Ø¬Ø©</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if report.summary %}
            <div style="padding: var(--space-md); background: var(--bg); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                <div style="font-weight: var(--fw-bold); font-size: var(--text-sm); margin-bottom: var(--space-xs);">Ø§Ù„Ù…Ù„Ø®Øµ</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.summary }}</p>
            </div>
            {% endif %}

            {% if report.strengths %}
            <div style="margin-bottom: var(--space-md);">
                <div style="font-weight: var(--fw-bold); font-size: var(--text-sm); color: var(--success); margin-bottom: var(--space-xs);">Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.strengths }}</p>
            </div>
            {% endif %}

            {% if report.improvements %}
            <div style="margin-bottom: var(--space-md);">
                <div style="font-weight: var(--fw-bold); font-size: var(--text-sm); color: var(--sv-orange); margin-bottom: var(--space-xs);">Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.improvements }}</p>
            </div>
            {% endif %}

            {% if report.recommendations %}
            <div>
                <div style="font-weight: var(--fw-bold); font-size: var(--text-sm); color: var(--info); margin-bottom: var(--space-xs);">Ø§Ù„ØªÙˆØµÙŠØ§Øª</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.recommendations }}</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card empty-state">
        <div class="empty-state-icon">ğŸ“Š</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯</div>
    </div>
    {% endif %}
</div>

<!-- ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ØµØµ -->
<div id="tab-sessions" style="display: none;">
    {% if session_reports %}
    <div class="card">
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø­ØµØ©</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                        <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                        <th>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</th>
                        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in session_reports %}
                    <tr>
                        <td style="font-weight: var(--fw-bold);">{{ report.session_title or '-' }}</td>
                        <td>{{ report.date.strftime('%Y-%m-%d') if report.date else '-' }}</td>
                        <td>{{ report.teacher_name or '-' }}</td>
                        <td>
                            {% if report.attended %}
                            <span class="badge badge-success">Ø­Ø§Ø¶Ø±</span>
                            {% else %}
                            <span class="badge badge-danger">ØºØ§Ø¦Ø¨</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if report.participation %}
                            <div class="progress" style="width: 80px; height: 6px;">
                                <div class="progress-bar" style="width: {{ report.participation }}%;"></div>
                            </div>
                            {% else %}
                            <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td style="font-size: var(--text-xs); color: var(--text-secondary); max-width: 200px;">
                            {{ report.notes or '-' }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="card empty-state">
        <div class="empty-state-icon">ğŸ“š</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø­ØµØµ Ø¨Ø¹Ø¯</div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block dashboard_js %}
<script>
function switchReportTab(tabName, btn) {
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.getElementById('tab-assessments').style.display = 'none';
    document.getElementById('tab-sessions').style.display = 'none';

    // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('#reportTabs .tab').forEach(t => t.classList.remove('active'));

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    document.getElementById('tab-' + tabName).style.display = 'block';
    btn.classList.add('active');
}
</script>
{% endblock %}
