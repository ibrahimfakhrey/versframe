{% extends "base_dashboard.html" %}

{% block title %}Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨ - {{ student.name_ar }}{% endblock %}
{% block topbar_title %}Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('assessor.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('assessor.assessments') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ“‹</span>
    <span>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
</a>
{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('assessor.assessments') }}" class="btn btn-sm btn-ghost">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</a>
{% endblock %}

{% block content %}
<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
<div class="card" style="margin-bottom: var(--space-xl);">
    <div style="display: flex; align-items: center; gap: var(--space-xl); flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: var(--space-lg);">
            <div class="avatar avatar-xl" style="background: linear-gradient(135deg, var(--sv-purple), var(--sv-orange)); color: white; font-size: var(--text-3xl);">
                {% if student.avatar_url %}
                <img src="{{ student.avatar_url }}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                {% else %}
                {{ student.name_ar[0] if student.name_ar else '?' }}
                {% endif %}
            </div>
            <div>
                <h2 style="font-size: var(--text-2xl); font-weight: var(--fw-extrabold); margin-bottom: var(--space-xs);">{{ student.name_ar }}</h2>
                <p style="color: var(--text-secondary); font-size: var(--text-sm);">{{ student.name_en or '' }}</p>
                <p style="color: var(--text-muted); font-size: var(--text-xs); direction: ltr; text-align: right;">{{ student.email }}</p>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div style="display: flex; gap: var(--space-xl); margin-right: auto;">
            <div style="text-align: center;">
                <div style="font-size: var(--text-3xl); font-weight: var(--fw-extrabold); color: var(--sv-purple);">{{ xp_total|default(0) }}</div>
                <div style="font-size: var(--text-xs); color: var(--text-secondary);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ XP</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: var(--text-3xl); font-weight: var(--fw-extrabold); color: var(--sv-orange);">{{ level|default(1) }}</div>
                <div style="font-size: var(--text-xs); color: var(--text-secondary);">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: var(--text-3xl); font-weight: var(--fw-extrabold); color: var(--success);">{{ assessment_history|length }}</div>
                <div style="font-size: var(--text-xs); color: var(--text-secondary);">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
            </div>
        </div>
    </div>
</div>

<div class="dashboard-grid">
    <div class="dashboard-grid-main">
        <!-- Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
        <div class="card" style="margin-bottom: var(--space-xl);">
            <div class="card-header">
                <h3 class="card-title">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
            </div>

            {% if assessment_history %}
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in assessment_history %}
                        <tr>
                            <td>
                                {% if item.scheduled_at %}
                                <div style="font-weight: var(--fw-bold);">{{ item.scheduled_at.strftime('%Y-%m-%d') }}</div>
                                <div style="font-size: var(--text-xs); color: var(--text-secondary);">{{ item.scheduled_at.strftime('%H:%M') }}</div>
                                {% else %}
                                <span style="color: var(--text-muted);">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge badge-purple">ØªÙ‚ÙŠÙŠÙ…</span>
                            </td>
                            <td>
                                {% if item.status.value == 'completed' %}
                                <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„</span>
                                {% elif item.status.value == 'in_progress' %}
                                <span class="badge badge-orange">Ø¬Ø§Ø±ÙŠ</span>
                                {% elif item.status.value == 'scheduled' %}
                                <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„</span>
                                {% else %}
                                <span class="badge badge-warning">{{ item.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if item.report and item.report.overall_score is not none %}
                                <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                    <div class="progress" style="width: 60px; height: 6px;">
                                        <div class="progress-bar" style="width: {{ item.report.overall_score }}%;"></div>
                                    </div>
                                    <span style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ item.report.overall_score }}%</span>
                                </div>
                                {% else %}
                                <span style="color: var(--text-muted); font-size: var(--text-sm);">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('assessor.assessment_detail', assessment_id=item.id) }}" class="btn btn-sm btn-primary">
                                    Ø¹Ø±Ø¶
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state" style="padding: var(--space-xl);">
                <div class="empty-state-icon">ğŸ“‹</div>
                <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨</div>
            </div>
            {% endif %}
        </div>

        <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¯Ø±Ø¬Ø§Øª (Ø¹Ù†ØµØ± Ù†Ø§Ø¦Ø¨) -->
        {% if assessment_history %}
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">ğŸ“ˆ ØªØ·ÙˆØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
            </div>
            <div style="display: flex; align-items: flex-end; gap: var(--space-xs); height: 160px; padding: var(--space-md);">
                {% for item in assessment_history %}
                {% if item.report and item.report.overall_score is not none %}
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: var(--space-xs);">
                    <span style="font-size: var(--text-xs); font-weight: var(--fw-bold);">{{ item.report.overall_score }}%</span>
                    <div style="width: 100%; max-width: 40px; height: {{ item.report.overall_score }}%; background: linear-gradient(to top, var(--sv-purple), var(--sv-orange)); border-radius: var(--radius-sm) var(--radius-sm) 0 0; min-height: 4px;"></div>
                    <span style="font-size: 9px; color: var(--text-muted);">{{ item.scheduled_at.strftime('%m/%d') if item.scheduled_at else '' }}</span>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <div class="dashboard-grid-aside">
        <!-- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">ğŸ‘¥ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h3>
            </div>
            {% if groups %}
            <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                {% for group in groups %}
                <div style="padding: var(--space-sm); background: var(--bg); border-radius: var(--radius-md);">
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ group.name }}</div>
                    <div style="font-size: var(--text-xs); color: var(--text-secondary);">{{ group.track_id or '' }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; color: var(--text-muted); font-size: var(--text-sm); padding: var(--space-md);">
                Ù„Ù… ÙŠÙ†Ø¶Ù… Ù„Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø©
            </div>
            {% endif %}
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
            </div>
            <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ student.name_ar }}</div>
                </div>
                {% if student.name_en %}
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ student.name_en }}</div>
                </div>
                {% endif %}
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                    <div>
                        <span class="badge badge-purple">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {{ level|default(1) }}</span>
                    </div>
                </div>
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ XP</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm); color: var(--sv-purple);">{{ xp_total|default(0) }} XP</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
