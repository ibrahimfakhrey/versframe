{% extends "base_dashboard.html" %}

{% block title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…{% endblock %}
{% block topbar_title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('assessor.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('assessor.assessments') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ“‹</span>
    <span>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
</a>
{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('assessor.assessments') }}" class="btn btn-sm btn-ghost">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</a>
{% endblock %}

{% block content %}
<!-- Ø±Ø£Ø³ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
<div class="card" style="margin-bottom: var(--space-xl);">
    <div style="display: flex; align-items: flex-start; justify-content: space-between; flex-wrap: wrap; gap: var(--space-lg);">
        <div style="display: flex; align-items: center; gap: var(--space-lg);">
            <div class="avatar avatar-xl" style="background: linear-gradient(135deg, var(--sv-purple), var(--sv-orange)); color: white; font-size: var(--text-3xl);">
                {% if student.avatar_url %}
                <img src="{{ student.avatar_url }}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                {% else %}
                {{ student.name_ar[0] if student.name_ar else '?' }}
                {% endif %}
            </div>
            <div>
                <h2 style="font-size: var(--text-2xl); font-weight: var(--fw-extrabold); margin-bottom: var(--space-xs);">{{ student.name_ar }}</h2>
                <div style="font-size: var(--text-sm); color: var(--text-secondary);">{{ student.name_en or '' }}</div>
                <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-sm);">
                    {% if assessment.status.value == 'completed' %}
                    <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„</span>
                    {% elif assessment.status.value == 'in_progress' %}
                    <span class="badge badge-orange">Ø¬Ø§Ø±ÙŠ</span>
                    {% elif assessment.status.value == 'scheduled' %}
                    <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„</span>
                    {% else %}
                    <span class="badge badge-warning">{{ assessment.status }}</span>
                    {% endif %}
                    {% if assessment.scheduled_at %}
                    <span class="badge badge-purple">{{ assessment.scheduled_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div style="display: flex; gap: var(--space-sm);">
            <a href="{{ url_for('assessor.student_profile', student_id=student.id) }}" class="btn btn-sm btn-outline">Ø¹Ø±Ø¶ Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨</a>
        </div>
    </div>
</div>

<div class="dashboard-grid">
    <div class="dashboard-grid-main">
        {% if report %}
        <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ -->
        <div class="card" style="margin-bottom: var(--space-xl);">
            <div class="card-header">
                <h3 class="card-title">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                {% if report.score is not none %}
                <div style="text-align: center; background: var(--sv-purple-glow); padding: var(--space-sm) var(--space-lg); border-radius: var(--radius-md);">
                    <div style="font-size: var(--text-2xl); font-weight: var(--fw-extrabold); color: var(--sv-purple);">{{ report.score }}%</div>
                    <div style="font-size: var(--text-xs); color: var(--text-secondary);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</div>
                </div>
                {% endif %}
            </div>

            {% if report.summary %}
            <div style="padding: var(--space-md); background: var(--bg); border-radius: var(--radius-md); margin-bottom: var(--space-lg);">
                <div style="font-weight: var(--fw-bold); margin-bottom: var(--space-sm);">Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.8;">{{ report.summary }}</p>
            </div>
            {% endif %}

            <!-- Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); margin-bottom: var(--space-lg);">
                <div style="padding: var(--space-md); background: var(--success-light); border-radius: var(--radius-md); border-right: 4px solid var(--success);">
                    <div style="font-weight: var(--fw-bold); color: var(--success); margin-bottom: var(--space-sm);">Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</div>
                    <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.strengths or 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ø¨Ø¹Ø¯' }}</p>
                </div>
                <div style="padding: var(--space-md); background: var(--warning-light); border-radius: var(--radius-md); border-right: 4px solid var(--warning);">
                    <div style="font-weight: var(--fw-bold); color: #856404; margin-bottom: var(--space-sm);">Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†</div>
                    <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.improvements or 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ø¨Ø¹Ø¯' }}</p>
                </div>
            </div>

            {% if report.recommendations %}
            <div style="padding: var(--space-md); background: var(--info-light); border-radius: var(--radius-md); border-right: 4px solid var(--info);">
                <div style="font-weight: var(--fw-bold); color: var(--info); margin-bottom: var(--space-sm);">Ø§Ù„ØªÙˆØµÙŠØ§Øª</div>
                <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.7;">{{ report.recommendations }}</p>
            </div>
            {% endif %}
        </div>
        {% else %}
        <!-- Ù†Ù…ÙˆØ°Ø¬ ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
        <div class="card" style="margin-bottom: var(--space-xl);">
            <div class="card-header">
                <h3 class="card-title">ğŸ“ ÙƒØªØ§Ø¨Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
            </div>

            <form method="POST" action="{{ url_for('assessor.submit_report', assessment_id=assessment.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}">

                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© (Ù…Ù† 100)</label>
                    <input type="number" name="score" class="form-input" min="0" max="100" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø©" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                    <textarea name="summary" class="form-textarea" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµØ§ Ø´Ø§Ù…Ù„Ø§ Ø¹Ù† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨..." required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</label>
                    <textarea name="strengths" class="form-textarea" rows="3" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø£Ø¨Ø¯Ø¹ ÙÙŠÙ‡ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†</label>
                    <textarea name="improvements" class="form-textarea" rows="3" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡ØŸ"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Ø§Ù„ØªÙˆØµÙŠØ§Øª</label>
                    <textarea name="recommendations" class="form-textarea" rows="3" placeholder="Ù…Ø§ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ù„ØªØ·ÙˆÙŠØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ"></textarea>
                </div>

                <div style="display: flex; gap: var(--space-sm); justify-content: flex-start; margin-top: var(--space-lg);">
                    <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    <button type="button" class="btn btn-ghost" onclick="history.back()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="dashboard-grid-aside">
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
            </div>
            <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ø·Ø§Ù„Ø¨</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ student.name_ar }}</div>
                </div>
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">ØªÙ‚ÙŠÙŠÙ…</div>
                </div>
                {% if assessment.scheduled_at %}
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ù…ÙˆØ¹Ø¯</div>
                    <div style="font-weight: var(--fw-bold); font-size: var(--text-sm);">{{ assessment.scheduled_at.strftime('%Y-%m-%d') }}</div>
                    <div style="font-size: var(--text-xs); color: var(--text-secondary);">{{ assessment.scheduled_at.strftime('%H:%M') }}</div>
                </div>
                {% endif %}
                <div>
                    <div style="font-size: var(--text-xs); color: var(--text-muted); margin-bottom: 2px;">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                    <div>
                        {% if assessment.status.value == 'completed' %}
                        <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„</span>
                        {% elif assessment.status.value == 'in_progress' %}
                        <span class="badge badge-orange">Ø¬Ø§Ø±ÙŠ</span>
                        {% elif assessment.status.value == 'scheduled' %}
                        <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„</span>
                        {% else %}
                        <span class="badge badge-warning">{{ assessment.status }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
            </div>
            <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                <a href="{{ url_for('assessor.student_profile', student_id=student.id) }}" class="btn btn-block btn-outline" style="justify-content: flex-start;">
                    ğŸ‘¤ Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨
                </a>
                <a href="{{ url_for('assessor.assessments') }}" class="btn btn-block btn-ghost" style="justify-content: flex-start;">
                    ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
