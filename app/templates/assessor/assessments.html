{% extends "base_dashboard.html" %}

{% block title %}Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª{% endblock %}
{% block topbar_title %}Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('assessor.dashboard') }}" class="sidebar-link">
    <span class="sidebar-icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</a>
<a href="{{ url_for('assessor.assessments') }}" class="sidebar-link active">
    <span class="sidebar-icon">ğŸ“‹</span>
    <span>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
</a>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title">ğŸ“‹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
    <p class="page-subtitle">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
</div>

<!-- ÙÙ„Ø§ØªØ± -->
<div class="card" style="margin-bottom: var(--space-xl);">
    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; align-items: center;">
        <div class="tabs" style="margin-bottom: 0; border-bottom: none; flex: 1;">
            <button class="tab active" onclick="filterAssessments('all', this)">Ø§Ù„ÙƒÙ„</button>
            <button class="tab" onclick="filterAssessments('scheduled', this)">Ù…Ø¬Ø¯ÙˆÙ„Ø©</button>
            <button class="tab" onclick="filterAssessments('in_progress', this)">Ø¬Ø§Ø±ÙŠØ©</button>
            <button class="tab" onclick="filterAssessments('completed', this)">Ù…ÙƒØªÙ…Ù„Ø©</button>
        </div>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
{% if assessments %}
<div class="card">
    <div class="table-wrapper">
        <table class="table" id="assessmentsTable">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for assessment in assessments %}
                <tr data-status="{{ assessment.status.value }}">
                    <td>
                        <div style="display: flex; align-items: center; gap: var(--space-sm);">
                            <div class="avatar avatar-sm">
                                {% if assessment.student and assessment.student.avatar_url %}
                                <img src="{{ assessment.student.avatar_url }}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                                {% else %}
                                {{ assessment.student.name_ar[0] if assessment.student and assessment.student.name_ar else '?' }}
                                {% endif %}
                            </div>
                            <div>
                                <div style="font-weight: var(--fw-bold);">{{ assessment.student.name_ar if assessment.student else '-' }}</div>
                                {% if assessment.student %}
                                <a href="{{ url_for('assessor.student_profile', student_id=assessment.student.id) }}" style="font-size: var(--text-xs); color: var(--sv-purple);">
                                    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        {% if assessment.scheduled_at %}
                        <div style="font-weight: var(--fw-bold);">{{ assessment.scheduled_at.strftime('%Y-%m-%d') }}</div>
                        <div style="font-size: var(--text-xs); color: var(--text-secondary);">{{ assessment.scheduled_at.strftime('%H:%M') }}</div>
                        {% else %}
                        <span style="color: var(--text-muted);">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge badge-purple">ØªÙ‚ÙŠÙŠÙ…</span>
                    </td>
                    <td>
                        {% if assessment.status.value == 'completed' %}
                        <span class="badge badge-success">Ù…ÙƒØªÙ…Ù„</span>
                        {% elif assessment.status.value == 'scheduled' %}
                        <span class="badge badge-info">Ù…Ø¬Ø¯ÙˆÙ„</span>
                        {% elif assessment.status.value == 'cancelled' %}
                        <span class="badge badge-danger">Ù…Ù„ØºÙŠ</span>
                        {% else %}
                        <span class="badge badge-warning">{{ assessment.status.value }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: var(--space-xs);">
                            <a href="{{ url_for('assessor.assessment_detail', assessment_id=assessment.id) }}" class="btn btn-sm btn-primary">
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card empty-state">
    <div class="empty-state-icon">ğŸ“‹</div>
    <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­Ø§Ù„ÙŠØ§</div>
    <p style="color: var(--text-muted); font-size: var(--text-sm);">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¹Ù†Ø¯ Ø¬Ø¯ÙˆÙ„ØªÙ‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
</div>
{% endif %}
{% endblock %}

{% block dashboard_js %}
<script>
function filterAssessments(status, btn) {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');

    // ØªØµÙÙŠØ© Ø§Ù„ØµÙÙˆÙ
    const rows = document.querySelectorAll('#assessmentsTable tbody tr');
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
